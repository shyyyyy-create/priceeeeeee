<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å•†å“æ¯”åƒ¹ç®¡ç†ç³»çµ±</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .hidden { display: none; }
        .card { transition: transform 0.2s; }
        .card:hover { transform: translateY(-5px); }
    </style>
</head>
<body class="bg-gray-50 min-h-screen p-4 md:p-8">

    <div class="max-w-6xl mx-auto">
        <header class="mb-8 text-center">
            <h1 class="text-3xl font-bold text-gray-800">ğŸ›ï¸ å•†å“æ¯”åƒ¹ç®¡ç†åŠ©æ‰‹</h1>
            <p class="text-gray-500">è¨˜éŒ„åƒ¹æ ¼ã€å„ªæƒ æœŸèˆ‡è¦æ ¼</p>
        </header>

        <section class="bg-white p-6 rounded-xl shadow-md mb-10">
            <h2 class="text-xl font-semibold mb-4 border-b pb-2" id="formTitle">æ–°å¢å•†å“ç™»è¨˜</h2>
            <form id="productForm" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <input type="hidden" id="editIndex" value="-1">
                
                <div>
                    <label class="block text-sm font-medium">å•†å“åç¨±</label>
                    <input type="text" id="pName" required class="w-full border p-2 rounded">
                </div>
                <div>
                    <label class="block text-sm font-medium">å•†å“åˆ†é¡</label>
                    <select id="pCategory" class="w-full border p-2 rounded" onchange="updateSubCategory()">
                        <option value="è­·è†šå“">è­·è†šå“</option>
                        <option value="åŒ–å¦å“Base">åŒ–å¦å“Base</option>
                        <option value="åŒ–å¦å“Eyes">åŒ–å¦å“Eyes</option>
                        <option value="åŒ–å¦å“Lip">åŒ–å¦å“Lip</option>
                        <option value="å…¶ä»–">å…¶ä»–</option>
                    </select>
                </div>

                <div>
                    <label class="block text-sm font-medium">å­åˆ†é¡</label>
                    <select id="pSubCategory" class="w-full border p-2 rounded"></select>
                </div>
                <div>
                    <label class="block text-sm font-medium">å•†å“é€£çµ (URL)</label>
                    <input type="url" id="pLink" class="w-full border p-2 rounded">
                </div>
                <div class="md:col-span-2">
                    <label class="block text-sm font-medium">åœ–ç‰‡é€£çµ (URL)</label>
                    <input type="url" id="pImg" class="w-full border p-2 rounded">
                </div>

                <div class="md:col-span-2 border-t pt-4">
                    <label class="block text-sm font-medium mb-2">å•†å“è¦æ ¼ (ç„¡ä¸Šé™å¢åŠ )</label>
                    <div id="specsContainer" class="space-y-2 mb-2">
                        <div class="flex gap-2">
                            <input type="text" placeholder="è¦æ ¼ (å¦‚: 50ml, è‰²è™Ÿ01)" class="spec-input flex-1 border p-2 rounded">
                            <button type="button" onclick="addSpecField()" class="bg-blue-500 text-white px-3 rounded">+</button>
                        </div>
                    </div>
                </div>

                <div class="border-t pt-4">
                    <label class="block text-sm font-medium text-gray-400">å•†å“åŸåƒ¹</label>
                    <input type="number" id="pPrice" required class="w-full border p-2 rounded">
                </div>
                <div class="border-t pt-4">
                    <label class="block text-sm font-medium text-red-500">å•†å“ç‰¹åƒ¹</label>
                    <input type="number" id="pSalePrice" class="w-full border p-2 rounded">
                    <div class="grid grid-cols-2 gap-2 mt-2">
                        <input type="date" id="saleStart" class="text-xs border p-1 rounded">
                        <input type="date" id="saleEnd" class="text-xs border p-1 rounded">
                    </div>
                </div>

                <div class="md:col-span-2 flex flex-wrap gap-6 bg-yellow-50 p-4 rounded-lg">
                    <div class="flex items-center gap-2">
                        <input type="checkbox" id="couponCheck" onchange="toggleDate('couponDates')">
                        <label for="couponCheck" class="font-bold">ğŸ« å„ªæƒ åˆ¸</label>
                        <div id="couponDates" class="hidden flex gap-2 ml-2">
                            <input type="date" id="couponStart" class="text-xs border p-1 rounded">
                            <input type="date" id="couponEnd" class="text-xs border p-1 rounded">
                        </div>
                    </div>
                    <div class="flex items-center gap-2">
                        <input type="checkbox" id="todaySpecialCheck" onchange="toggleDate('specialDates')">
                        <label for="todaySpecialCheck" class="font-bold text-orange-600">ğŸ”¥ ä»Šå¤©ç‰¹å„ª</label>
                        <div id="specialDates" class="hidden flex gap-2 ml-2">
                            <input type="date" id="specialStart" class="text-xs border p-1 rounded">
                            <input type="date" id="specialEnd" class="text-xs border p-1 rounded">
                        </div>
                    </div>
                </div>

                <div class="md:col-span-2">
                    <button type="submit" class="w-full bg-black text-white py-3 rounded-lg font-bold hover:bg-gray-800">ä¿å­˜å•†å“è³‡æ–™</button>
                </div>
            </form>
        </section>

        <h2 class="text-2xl font-bold mb-4">æˆ‘çš„å•†å“æ¸…å–®</h2>
        <div id="productList" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            </div>
    </div>

    <script>
        const categories = {
            "è­·è†šå“": ["åŒ–å¦æ°´", "ç²¾è¯", "ä¹³æ¶²/é¢éœœ", "é˜²æ›¬", "æ½”é¢", "å¸å¦"],
            "åŒ–å¦å“Base": ["å¦å‰", "æ°£å¢Š", "ç²‰åº•", "é®ç‘•", "è…®ç´…", "å…‰/é™°å½±"],
            "åŒ–å¦å“Eyes": ["çœ‰ç­†", "çœ¼ç·š/è‡¥è ¶", "çœ¼å½±", "ç«æ¯›è†"],
            "åŒ–å¦å“Lip": ["å”‡ç·šç­†", "å”‡é‡‰", "å”‡è†"],
            "å…¶ä»–": ["æ‰‹éƒ¨è†šç†", "èº«é«”è­·ç†", "é¦™æ°´", "é›¶é£Ÿ", "ç”Ÿæ´»é›œè²¨"]
        };

        let products = JSON.parse(localStorage.getItem('priceTracker')) || [];

        function updateSubCategory() {
            const main = document.getElementById('pCategory').value;
            const sub = document.getElementById('pSubCategory');
            sub.innerHTML = categories[main].map(s => `<option value="${s}">${s}</option>`).join('');
        }

        function addSpecField(value = "") {
            const div = document.createElement('div');
            div.className = "flex gap-2 mt-2";
            div.innerHTML = `<input type="text" value="${value}" class="spec-input flex-1 border p-2 rounded">
                             <button type="button" onclick="this.parentElement.remove()" class="bg-red-400 text-white px-3 rounded">âœ•</button>`;
            document.getElementById('specsContainer').appendChild(div);
        }

        function toggleDate(id) {
            document.getElementById(id).classList.toggle('hidden');
        }

        document.getElementById('productForm').onsubmit = function(e) {
            e.preventDefault();
            const editIndex = parseInt(document.getElementById('editIndex').value);
            
            const specs = Array.from(document.querySelectorAll('.spec-input')).map(input => input.value).filter(v => v);
            
            const product = {
                name: document.getElementById('pName').value,
                category: document.getElementById('pCategory').value,
                subCategory: document.getElementById('pSubCategory').value,
                link: document.getElementById('pLink').value,
                img: document.getElementById('pImg').value || 'https://via.placeholder.com/150',
                specs: specs,
                price: document.getElementById('pPrice').value,
                salePrice: document.getElementById('pSalePrice').value,
                salePeriod: [document.getElementById('saleStart').value, document.getElementById('saleEnd').value],
                coupon: { active: document.getElementById('couponCheck').checked, period: [document.getElementById('couponStart').value, document.getElementById('couponEnd').value] },
                special: { active: document.getElementById('todaySpecialCheck').checked, period: [document.getElementById('specialStart').value, document.getElementById('specialEnd').value] },
                history: editIndex > -1 ? products[editIndex].history : []
            };

            // è¨˜éŒ„åƒ¹æ ¼æ­·å²
            product.history.push({ date: new Date().toLocaleDateString(), price: product.salePrice || product.price });

            if (editIndex > -1) products[editIndex] = product;
            else products.push(product);

            localStorage.setItem('priceTracker', JSON.stringify(products));
            this.reset();
            renderProducts();
            location.reload(); // é‡æ–°æ•´ç†æ¸…å–®
        };

        function renderProducts() {
            const list = document.getElementById('productList');
            list.innerHTML = products.map((p, index) => `
                <div class="card bg-white rounded-xl shadow overflow-hidden border">
                    <img src="${p.img}" class="w-full h-48 object-cover">
                    <div class="p-4">
                        <span class="text-xs bg-gray-200 px-2 py-1 rounded">${p.category} - ${p.subCategory}</span>
                        <h3 class="font-bold text-lg mt-1">${p.name}</h3>
                        <p class="text-sm text-gray-500">è¦æ ¼: ${p.specs.join(', ')}</p>
                        
                        <div class="mt-3">
                            <span class="line-through text-gray-400">$${p.price}</span>
                            <span class="text-xl font-bold text-red-500 ml-2">$${p.salePrice || p.price}</span>
                        </div>
                        
                        ${p.salePeriod[0] ? `<p class="text-xs text-red-400">ç‰¹åƒ¹æœŸ: ${p.salePeriod[0]} ~ ${p.salePeriod[1]}</p>` : ''}
                        
                        <div class="flex gap-2 mt-2">
                            ${p.coupon.active ? `<span class="bg-yellow-100 text-yellow-700 text-[10px] p-1 rounded">åˆ¸: ${p.coupon.period[1]}æ­¢</span>` : ''}
                            ${p.special.active ? `<span class="bg-orange-100 text-orange-700 text-[10px] p-1 rounded">ğŸ”¥ ç‰¹å„ª: ${p.special.period[1]}æ­¢</span>` : ''}
                        </div>

                        <div class="mt-4 border-t pt-2">
                            <details class="text-xs text-gray-500 cursor-pointer">
                                <summary>æŸ¥çœ‹æ­·å²åƒ¹æ ¼</summary>
                                <ul class="mt-1">${p.history.map(h => `<li>${h.date}: $${h.price}</li>`).join('')}</ul>
                            </details>
                        </div>

                        <div class="flex gap-2 mt-4">
                            <button onclick="editProduct(${index})" class="flex-1 bg-gray-100 text-sm py-1 rounded">ç·¨è¼¯</button>
                            <button onclick="deleteProduct(${index})" class="flex-1 bg-red-50 text-red-500 text-sm py-1 rounded">åˆªé™¤</button>
                            <a href="${p.link}" target="_blank" class="flex-1 bg-blue-50 text-blue-500 text-sm py-1 text-center rounded">é€£çµ</a>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function deleteProduct(index) {
            if(confirm('ç¢ºå®šåˆªé™¤å—ï¼Ÿ')) {
                products.splice(index, 1);
                localStorage.setItem('priceTracker', JSON.stringify(products));
                renderProducts();
            }
        }

        function editProduct(index) {
            const p = products[index];
            document.getElementById('pName').value = p.name;
            document.getElementById('pCategory').value = p.category;
            updateSubCategory();
            document.getElementById('pSubCategory').value = p.subCategory;
            document.getElementById('pPrice').value = p.price;
            document.getElementById('pSalePrice').value = p.salePrice;
            document.getElementById('editIndex').value = index;
            document.getElementById('formTitle').innerText = "ç·¨è¼¯å•†å“ï¼š" + p.name;
            window.scrollTo(0, 0);
        }

        updateSubCategory();
        renderProducts();
    </script>
</body>
</html>
